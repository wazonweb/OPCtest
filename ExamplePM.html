<button onclick="connect()">Connect to PM sensor</button>
<p>PM data: <span id="pm">--</span> ug/m^3</p>

<script>
  let pmChar;

  async function connect() {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ name: 'ESP32_BLE_Server' }],
      optionalServices: ['4fafc201-1fb5-459e-8fcc-c5c9c331914b']
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService('4fafc201-1fb5-459e-8fcc-c5c9c331914b');

    pmChar = await service.getCharacteristic('beb5483f-36e1-4688-b7f5-ea07361b26a8');

    pmChar.startNotifications().then(char => {
      char.addEventListener('characteristicvaluechanged', event => {
        const value = new TextDecoder().decode(event.target.value);
        document.getElementById('pm').textContent = value;
      });
    });

    alert("Connected to ESP32_BMV080!");
  }

</script>
