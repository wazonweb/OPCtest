
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESP32 BLE Control</title>
  <!-- Viewport meta tag for proper zoom on phones and laptops -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <button onclick="connect()">Connect to ESP32</button>
  <p><input type="text" id="textValue" placeholder="Enter text"></p>
  <p><button onclick="sendText()">Send Text</button></p>
  <p><span id="temp"></span></p>

  <script>
    let ledChar, tempChar;

    async function connect() {
      const device = await navigator.bluetooth.requestDevice({
        filters: [{ name: 'ESP32_FairyLight' }],
        optionalServices: ['4fafc201-1fb5-459e-8fcc-c5c9c331914b']
      });

      const server = await device.gatt.connect();
      const service = await server.getPrimaryService('4fafc201-1fb5-459e-8fcc-c5c9c331914b');

      ledChar = await service.getCharacteristic('beb5483e-36e1-4688-b7f5-ea07361b26a8');
      tempChar = await service.getCharacteristic('6e400003-b5a3-f393-e0a9-e50e24dcca9e');

      tempChar.startNotifications().then(char => {
        char.addEventListener('characteristicvaluechanged', event => {
          let value = new TextDecoder().decode(event.target.value);
          value = value.replace(/\n/g, '\n').replace(/\r\n/g, '\n');
          const tempElem = document.getElementById('temp');
          tempElem.style.whiteSpace = 'pre-wrap';
          tempElem.textContent = value;
        });
      });

      alert("Connected to ESP32!");
    }

    async function sendText() {
      const textValue = document.getElementById('textValue').value;
      if (!textValue) {
        alert("Please enter some text");
        return;
      }
      const encodedValue = new TextEncoder().encode(textValue);
      await ledChar.writeValue(encodedValue);
      alert(`Sent: ${textValue}`);
    }
  </script>
</body>
</html>
